<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.OrderMapper">

    <resultMap id="orderResultMap" type="entity.shop.Order">
        <id property="orderId" column="order_id"/>
        <result property="userId" column="user_id"/>
        <result property="finalAmount" column="final_amount"/>
        <result property="Off" column="off_amount"/>
        <result property="createTime" column="create_time" javaType="java.time.LocalDateTime" typeHandler="DAO.LocalDateTimeToLongTypeHandler"/>
        <result property="expectTime" column="expect_time" javaType="java.time.LocalDateTime" typeHandler="DAO.LocalDateTimeToLongTypeHandler"/>
        <result property="address" column="address"/>
        <result property="payWay" column="pay_way"/>
        <collection property="items" ofType="entity.shop.OrderItem"
                    select="mapper.OrderItemMapper.findByOrderId" column="order_id"/>
    </resultMap>

    <select id="findById" resultMap="orderResultMap">
        SELECT * FROM orders WHERE order_id = #{orderId}
    </select>
    
    <select id="findAll" resultMap="orderResultMap">
        SELECT * FROM orders
    </select>

    <select id="findByUserId" resultMap="orderResultMap">
        SELECT * FROM orders WHERE user_id = #{userId} ORDER BY create_time DESC
    </select>

    <insert id="insert" parameterType="entity.shop.Order">
        INSERT INTO orders (order_id, user_id, final_amount, off_amount, create_time, expect_time, address, pay_way)
        VALUES (
        #{orderId}, #{userId}, #{finalAmount}, #{Off},
        #{createTime, typeHandler=DAO.LocalDateTimeToLongTypeHandler},
        #{expectTime, typeHandler=DAO.LocalDateTimeToLongTypeHandler},
        #{address}, #{payWay}
        )
    </insert>
</mapper>